@page "/theses"
@using PhDManager.Core.IServices
@using PhDManager.Core.Models

@inject IThesisService ThesisService
@inject NavigationManager NavigationManager

<PageTitle>Thesis Selection</PageTitle>

<AuthorizeView Roles=@($"{nameof(Role.Admin)}, {nameof(Role.Teacher)}")>
    <Authorized>
        <RadzenRow>
            <RadzenButton class="rz-m-4" Click="@NewThesis">Add new thesis</RadzenButton>
        </RadzenRow>
    </Authorized>
</AuthorizeView>

<RadzenDataList Data="@_theses" TItem="Thesis">
    <Template Context="thesis">
        <RadzenStack>
            <RadzenText TextStyle="TextStyle.H5">@thesis.Title</RadzenText>
            <RadzenStack Gap="6" Orientation="Orientation.Horizontal">
                <RadzenIcon Icon="description" />
                <RadzenText TextStyle="TextStyle.Body1">@thesis.Description</RadzenText>
            </RadzenStack>
            <RadzenStack Gap="6" Orientation="Orientation.Horizontal">
                <RadzenIcon Icon="face" />
                <RadzenText TextStyle="TextStyle.Body1">@thesis.User?.DisplayName</RadzenText>
            </RadzenStack>
            <RadzenButton Text="Select" Click="@(() => SelectThesis(thesis.ThesisId))" />
        </RadzenStack>
    </Template>
</RadzenDataList>

@code {
    private List<Thesis>? _theses;

    protected override async Task OnInitializedAsync()
    {
        _theses = await ThesisService.GetTheses();
    }

    private void SelectThesis(int thesisId)
    {
        NavigationManager.NavigateTo($"/theses/{thesisId}");
    }

    private void NewThesis()
    {
        NavigationManager.NavigateTo("/theses/add");
    }
}
