@page "/thesis"
@using PhDManager.Core.IServices
@using PhDManager.Core.Models

@attribute [Authorize]

@inject IThesisService ThesisService
@inject NavigationManager NavigationManager

<PageTitle>Thesis Selection</PageTitle>

<AuthorizeView Roles=@($"{nameof(Role.Admin)}, {nameof(Role.Teacher)}")>
    <Authorized>
        <RadzenButton Click="@NewThesis">Add new thesis</RadzenButton>
    </Authorized>
</AuthorizeView>

<RadzenDataList Data="@_theses" TItem="Thesis">
    <Template Context="thesis">
        <RadzenStack>
            <RadzenText TextStyle="TextStyle.H4">@thesis.Title</RadzenText>
            <RadzenStack Gap="0">
                <RadzenText TextStyle="TextStyle.H5">Description</RadzenText>
                <RadzenText>@thesis.Description</RadzenText>
            </RadzenStack>
            <RadzenStack Gap="0">
                <RadzenText TextStyle="TextStyle.H5">Supervisor</RadzenText>
                <RadzenText>@thesis.User?.DisplayName</RadzenText>
            </RadzenStack>
            <RadzenButton Text="Select" Click="@(() => SelectThesis(thesis.ThesisId))" />
        </RadzenStack>
    </Template>
</RadzenDataList>

@code {
    private List<Thesis>? _theses;

    protected override async Task OnInitializedAsync()
    {
        _theses = await ThesisService.GetTheses();
    }

    private void SelectThesis(int thesisId)
    {
        NavigationManager.NavigateTo($"/thesis/{thesisId}");
    }

    private void NewThesis()
    {
        NavigationManager.NavigateTo("/thesis/add");
    }
}
