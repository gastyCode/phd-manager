@page "/login"

@using PhDManager.Core.IServices
@using PhDManager.Core.ValidationModels

@inject IUserService UserService
@inject NavigationManager NavigationManager

<PageTitle>Log in</PageTitle>

<RadzenText TextStyle="TextStyle.H3">Login</RadzenText>

<RadzenAlert @bind-Visible="@_errorVisible" AlertStyle="AlertStyle.Danger" Close="@OnClose">
    The credentials you provided are invalid. Please try again.
</RadzenAlert>

<EditForm Model="UserLogin" FormName="login" OnSubmit="@HandleSubmit">
    <RadzenStack>
        <RadzenLabel For="@((UserLogin user) => user.Username)" Text="Username" Component="Username" />
        <RadzenTextBox @bind-Value="@UserLogin.Username" Name="Username" />

        <RadzenLabel For="@((UserLogin user) => user.Password)" Text="Password" Component="Password" />
        <RadzenPassword @bind-Value="@UserLogin.Password" Name="Password" />


        <RadzenButton Text="Login" ButtonType="ButtonType.Submit" ButtonStyle="ButtonStyle.Primary" />
    </RadzenStack>
</EditForm>

@code {
    [SupplyParameterFromForm]
    private UserLogin UserLogin { get; set; } = default!;

    protected override void OnInitialized()
    {
        UserLogin = new();
    }

    private bool _errorVisible = false;

    public void OnClose()
    {
        _errorVisible = false;
    }

    public async Task HandleSubmit()
    {
        var result = await UserService.Login(UserLogin);

        if (result is null)
    {
            _errorVisible = true;
        }
        NavigationManager.NavigateTo("/");
    }
}
